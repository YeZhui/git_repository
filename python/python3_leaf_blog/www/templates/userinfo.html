{% extends '__base__.html' %}

{% block title %}个人资料{% endblock %}

{% block beforehead %}
	<link rel="stylesheet" href="/static/css/components/form-file.css" />
	<link rel="stylesheet" href="/static/css/components/upload.css" />
	<script src="/static/js/components/upload.js"></script>
<script>
$(function(){
	$("#blog_list").removeClass("uk-active");
	$("#blog_edit").removeClass("uk-active");
	$("#manages").removeClass("uk-active");
	$("#info").addClass("uk-active");
});
$(function () {
	var vmUserInfo = new Vue({
		el: '#vm',
		data: {
			name: '',
		},
		methods: {
			submit: function (event) {
				event.preventDefault();
				var $form = $('#vm');
				if (! this.name.trim()) {
					return $form.showFormError('请输入新的用户名');
				}
				$form.postJSON('/api/save/userinfo', {
					name: this.name.trim(),
				}, function (err, r) {
					if (err) {
						return $form.showFormError(err);
					}
					return location.assign('/userinfo/save');
				});
			}
		}
	});
	$('#vm').show();
});
</script>
{% endblock %}

{% block content %}

	<div class="uk-width-medium-3-5">
		<form id="vm" v-on="submit: submit" class="uk-form">
			<div class="uk-form-row">
				<label class="uk-form-label">电子邮箱:{{ __user__.email }}</label>
			</div>
			<div class="uk-form-row">
				<span>
					{% if edit_flag == 1 %}
					<label class="uk-form-label">用户名:</label>
					<input type="text" v-model="name" width="120">
					<button type="submit" class="uk-button uk-button-success"><i class="uk-icon-check"></i>保存</button>
					<button class="uk-button" type="button"><i class="uk-icon-close"></i><a href="/userinfo/{{ __user__.id }}">取消</a></button>
					{% else %}
					<label class="uk-form-label">用户名:{{ __user__.name }}</label>
					<button class="uk-button" type="button"><i class="uk-icon-edit"></i><a href="/userinfo/edit/{{ __user__.id }}">修改用户名</a></button>
					{% endif %}
				</span>
			</div>
			<div class="uk-form-row">
				{% if __user__.admin %}
					<label class="uk-form-label">用户级别:超级超级用户</label>
				{% else %}
					<label class="uk-form-label">用户级别:普通用户</label>
				{% endif %}
			</div>
			<div class="uk-form-row">
				<label class="uk-form-label">注册时间:{{ created_date }} </label>
			</div>
		</form>
	</div>
	<div class="uk-width-medium-2-5">
		<div class="uk-panel uk-panel-box">
			<div class="uk-text-center uk-form-file">
				<img class="uk-border-circle uk-thumbnail uk-thumbnail-small" src="{{ __user__.image }}">
				<div id="upload-drop" class="uk-placeholder">
					<i class="uk-icon-cloud-upload uk-icon-medium uk-text-muted uk-margin-small-right"></i> 将文件拖拽至此 或 <a class="uk-form-file">点击上传头像<input id="upload-select" name="file" type="file"></a>
				</div>
				<div id="progressbar" class="ui-progress uk-hidden">
					<div class="uk-progress-bar" style="width: 0%;">0%</div>
				</div>
					<script>
	$(function(){
		var progressbar = $("#progressbar"),
		bar = progressbar.find('.uk-progress-bar'),
		settings = {
		action : '/upload/userimg',
		allow : '*.(jpg|jpeg|gif|png)',
		param : 'FILES', 
		loadstart : function(){
			bar.css("width", "0%").text("0%");
			progressbar.removeClass("uk-hidden");
		},
		progress : function(percent){
			percent = Math.ceil(percent);
			bar.css("width", percent+"%").text(percent+"%");
		},
		allcomplete : function(response){
			bar.css("width", "100%").text("100%");
			setTimeout(function(){
				progressbar.addClass("uk-hidden");
			}, 250);
			refresh();
		}
		};
		
		var select = UIkit.uploadSelect($("#upload-select"), settings),
			drop = UIkit.uploadDrop($("#upload-drop"), settings);
	});
</script>
			</div>
		</div>
	</div>

{% endblock %}
